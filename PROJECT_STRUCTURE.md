# NATS Driver Registry - Project Structure & Deployment Guide

**Domain:** `www.rokthenats.co.za`

## Overview
This is a full-stack web application for NATS (National Autocross Team Series) karting driver registration, event entry management, and payment processing. The application uses Node.js/Express backend with PostgreSQL database and responsive HTML/CSS frontend interfaces.

---

## Core Project Files

### 1. **Backend Files**

#### `server.js` | **JavaScript (Node.js)**
- **Type:** Express.js API Server
- **Purpose:** Main backend server that handles all API endpoints, database operations, and business logic
- **Location on Live Server:** Root directory
- **Key Functions:**
  - User authentication (driver login/registration)
  - Driver profile management
  - Event entry management
  - Message/contact form handling
  - Payment processing integration with PayFast
  - Email notifications via Mandrill API
  - Audit logging for admin tracking
  - Database initialization and migrations
- **Dependencies:** Express, PostgreSQL, bcryptjs, uuid, axios, dotenv
- **Port:** 3000 (production should use port 80/443 behind reverse proxy)
- **Database Connection:** PostgreSQL (PlanetScale cloud database)

#### `package.json` | **JSON Configuration**
- **Type:** Node.js Project Manifest
- **Purpose:** Defines project metadata, dependencies, and run scripts
- **Location on Live Server:** Root directory (must be present)
- **Critical Dependencies:**
  - `express` - Web framework
  - `pg` - PostgreSQL driver
  - `bcryptjs` - Password hashing
  - `uuid` - Unique ID generation
  - `axios` - HTTP client for API calls
  - `cors` - Cross-origin resource sharing
  - `dotenv` - Environment variable management

#### `package-lock.json` | **JSON Lock File**
- **Type:** Dependency Version Lock
- **Purpose:** Ensures reproducible installations of exact package versions
- **Location on Live Server:** Root directory
- **Note:** Auto-generated by npm install; include in deployment

#### `.env` | **Environment Configuration**
- **Type:** Environment Variables File
- **Purpose:** Stores sensitive configuration (database credentials, API keys)
- **Location on Live Server:** Root directory (DO NOT commit to version control)
- **Required Variables:**
  ```
  DB_HOST=<database-host>
  DB_PORT=<database-port>
  DB_DATABASE=<database-name>
  DB_USERNAME=<database-user>
  DB_PASSWORD=<database-password>
  PORT=3000
  NODE_ENV=production
  ```
- **Sensitive Data:** Database credentials, API keys for Mandrill, PayFast merchant details

#### `code.gs` | **Google Apps Script (JavaScript)**
- **Type:** Google Sheets Integration Script
- **Purpose:** Backend integration with Google Sheets for data storage/synchronization
- **Location on Live Server:** NOT deployed to web server (runs on Google's infrastructure)
- **Deployment Method:** Deployed via Google Apps Script editor
- **Functions:** Data synchronization, Sheet operations, webhook handling
- **Script Properties Required:**
  - `SPREADSHEET_ID` - Google Sheet ID
  - `ADMIN_SECRET` - Admin authentication token
  - `ADMIN_NOTIFY_EMAIL` - Admin notification email

---

### 2. **Frontend - HTML Pages**

#### `index.html` | **HTML5 + CSS + JavaScript**
- **Type:** Public Landing/Driver Portal Main Page
- **Purpose:** Main entry point for driver portal - driver registration, login, profile management
- **Location on Live Server:** Root directory / `www.rokthenats.co.za/`
- **Accessible To:** Public (drivers, unregistered users)
- **Key Sections:**
  - Driver login/registration
  - Profile management (name, email, phone, license info)
  - Password reset functionality
  - Event entries view
  - Contact admin messaging
- **Dependencies:** Bootstrap (CDN), Custom CSS (main.css)
- **API Calls:** `/api/registerDriver`, `/api/loginDriver`, `/api/getProfile`, `/api/updateProfile`

#### `driver_portal.html` | **HTML5 + CSS + JavaScript**
- **Type:** Protected Driver Portal (Login Required)
- **Purpose:** Full driver dashboard after authentication
- **Location on Live Server:** Root directory / `www.rokthenats.co.za/driver_portal.html`
- **Access Requirements:** Must be logged in with valid credentials
- **Key Sections:**
  - Driver profile with email display
  - Event entries management (create, edit, view)
  - Entry rental system
  - Message/contact form for admin communication
  - Account settings
- **Special Features:**
  - Modal confirmation dialog for save operations
  - Green highlight (#4ade80) on critical sections
  - Real-time profile sync with backend
  - Entry status tracking
  - Contact admin with email/phone collection
- **API Calls:** Multiple endpoints for profile, entries, and messaging

#### `admin.html` | **HTML5 + CSS + JavaScript**
- **Type:** Protected Admin Dashboard (Admin Login Required)
- **Purpose:** Administrative interface for system management
- **Location on Live Server:** Root directory / `www.rokthenats.co.za/admin.html`
- **Access Requirements:** Must login with admin credentials (password: natsadmin2026)
- **Key Sections:**
  - Drivers Tab - View/manage all driver registrations
  - Messages Tab - View driver messages with unread badge
  - Audit logging view
  - Driver profile editing
  - System management
- **Features:**
  - Dual-tab interface (Drivers/Messages)
  - Unread message counter badge
  - Message read/unread status tracking
  - Display of both registered account email and contact email
  - Mark messages as read functionality
  - Refresh and clear read messages buttons
- **API Calls:** `/api/getDrivers`, `/api/getAdminMessages`, `/api/markMessageAsRead`

#### `admin_audit_log.html` | **HTML5 + CSS + JavaScript**
- **Type:** Protected Admin Audit Log Page
- **Purpose:** View audit trail of all system changes
- **Location on Live Server:** Root directory / `www.rokthenats.co.za/admin_audit_log.html`
- **Access Requirements:** Admin login required
- **Data Displayed:**
  - Driver ID and email
  - Action performed
  - Field changed
  - Old and new values
  - Timestamp
  - IP address of change
- **API Calls:** `/api/getAuditLog`

#### `reset-password.html` | **HTML5 + CSS + JavaScript**
- **Type:** Public Password Reset Page
- **Purpose:** Allow drivers to reset forgotten passwords
- **Location on Live Server:** Root directory / `www.rokthenats.co.za/reset-password.html`
- **Access:** Public (no login required)
- **Features:**
  - Email verification
  - Reset token validation
  - New password entry
- **API Calls:** `/api/requestPasswordReset`, `/api/resetPassword`

#### `payment-success.html` | **HTML5 + CSS + JavaScript**
- **Type:** Payment Confirmation Page
- **Purpose:** Display success message after payment completion
- **Location on Live Server:** Root directory / `www.rokthenats.co.za/payment-success.html`
- **Redirect:** Automatic after PayFast payment completion
- **Content:** Confirmation details, reference numbers, next steps

#### `payment-cancel.html` | **HTML5 + CSS + JavaScript**
- **Type:** Payment Cancellation Page
- **Purpose:** Display message if payment is cancelled
- **Location on Live Server:** Root directory / `www.rokthenats.co.za/payment-cancel.html`
- **Redirect:** If user cancels PayFast payment
- **Content:** Cancellation explanation, retry option, contact support

#### `driver_portal.html` (Temp Variants)
- `temp_index.html`, `temp_index2.html`, `temp_index_secret.html`, `temp_driver_secret.html` - **Backup/Testing files**
- **Type:** HTML5
- **Purpose:** Temporary versions created during development
- **Location on Live Server:** Root directory (OPTIONAL - can be removed in production)
- **Status:** Development/backup only - not served to public

---

### 3. **Styling Files**

#### `css/main.css` | **CSS3 Stylesheet**
- **Type:** Cascading Style Sheets
- **Purpose:** All styling for HTML pages (colors, layouts, animations, responsive design)
- **Location on Live Server:** `/css/main.css`
- **Key Elements Styled:**
  - Green accent color: `--spring: #4ade80` (bright spring green)
  - Modal dialog animations
  - Button and form styling
  - Tab system styling
  - Message display styling (unread borders, email highlighting)
  - Responsive design for mobile/tablet/desktop
  - Entry and rental section styling
- **Features:**
  - CSS variables for consistent theming
  - Animations: confirmScaleIn, fadeIn, slideIn
  - Mobile-first responsive design
  - Dark/light mode compatibility
  - Print-friendly styles

---

### 4. **Configuration & Documentation Files**

#### `LIVENATSSITE.code-workspace` | **VS Code Workspace**
- **Type:** Editor Configuration
- **Purpose:** VS Code workspace settings for development
- **Location on Live Server:** NOT needed (development only)
- **Use:** Open workspace in VS Code for proper project configuration

#### `.env.example` | **Environment Template** (If exists)
- **Type:** Documentation
- **Purpose:** Template showing required environment variables
- **Location on Live Server:** NOT deployed
- **Use:** Reference for what variables are needed in `.env`

#### `README.md` | **Project Documentation** (If exists)
- **Type:** Markdown Documentation
- **Purpose:** Project overview and setup instructions
- **Location on Live Server:** NOT served to public (documentation only)

#### Various `.md` Documentation Files
- `START_HERE.md`, `LIVE_DEPLOYMENT_GUIDE.md`, `ACTION_CHECKLIST.md`, etc.
- **Type:** Markdown Documentation
- **Purpose:** Development notes, deployment guides, status tracking
- **Location on Live Server:** NOT deployed (admin/development reference only)

---

### 5. **Database Files**

#### PostgreSQL Database (Cloud - PlanetScale)
- **Type:** Relational Database
- **Purpose:** Persistent data storage for entire application
- **Location:** Cloud-hosted (not a local file)
- **Connection:** Via `DB_HOST`, `DB_PORT`, `DB_USERNAME`, `DB_PASSWORD` in `.env`
- **Tables Created:**
  - `drivers` - Driver registration and profile info
  - `entries` - Event entries for drivers
  - `rentals` - Equipment rental tracking
  - `admin_messages` - Driver messages to admin
  - `audit_log` - System action audit trail
  - Other tables as needed for PayFast integration

---

### 6. **Supporting Files**

#### `node_modules/` | **Directory (Generated)**
- **Type:** Package Dependencies Directory
- **Purpose:** Contains all npm packages and dependencies
- **Location on Live Server:** Root directory
- **Note:** Generated by `npm install`; DO NOT manually edit or commit to version control
- **Size:** ~200MB+ (do not upload directly; run `npm install` on server)

#### `.git/` | **Directory (Generated)**
- **Type:** Git Version Control
- **Purpose:** Local git repository history
- **Location on Live Server:** NOT deployed (keep development only)
- **Use:** Local version control during development

#### `.gitattributes` | **Git Configuration**
- **Type:** Git Configuration
- **Purpose:** Line-ending and file handling rules
- **Location on Live Server:** NOT deployed

#### `server_log.txt` | **File (Generated)**
- **Type:** Server Log
- **Purpose:** Runtime logs from server execution
- **Location on Live Server:** Root directory (auto-generated)
- **Use:** Debugging and monitoring

---

## Live Deployment Directory Structure

When deployed to **www.rokthenats.co.za**, the server directory should have this structure:

```
/var/www/rokthenats.co.za/
│
├── server.js                 (Main Express server)
├── code.gs                   (Google Sheets integration - reference only)
├── package.json              (Dependencies manifest)
├── package-lock.json         (Dependency lock)
├── .env                      (Environment variables - NEVER commit)
│
├── index.html                (Public landing page)
├── driver_portal.html        (Driver dashboard - login required)
├── admin.html                (Admin dashboard - admin login required)
├── admin_audit_log.html      (Audit log viewer - admin only)
├── reset-password.html       (Password reset form)
├── payment-success.html      (Payment confirmation)
├── payment-cancel.html       (Payment cancellation)
│
├── css/
│   └── main.css              (All styling)
│
├── node_modules/             (Generated by npm install)
│   └── [500+ package folders]
│
└── [Other files - optional in production]
    ├── server_log.txt        (Auto-generated logs)
    └── temp_*.html           (Can be removed)
```

---

## Deployment Checklist

### Files to Deploy to Production:
✅ `server.js`  
✅ `package.json`  
✅ `package-lock.json`  
✅ `.env` (create with production values)  
✅ `index.html`  
✅ `driver_portal.html`  
✅ `admin.html`  
✅ `admin_audit_log.html`  
✅ `reset-password.html`  
✅ `payment-success.html`  
✅ `payment-cancel.html`  
✅ `css/main.css`  

### Setup Steps:
1. Create `.env` file on server with production database credentials
2. Run `npm install` to generate `node_modules/`
3. Start server with `npm start` or `node server.js`
4. Configure reverse proxy (Nginx/Apache) for SSL and domain routing
5. Verify all pages accessible at https://www.rokthenats.co.za/

### Files NOT to Deploy:
❌ `.git/`, `.gitattributes`  
❌ `node_modules/` (generate fresh with `npm install`)  
❌ `*.md` documentation files  
❌ `LIVENATSSITE.code-workspace`  
❌ Temporary/backup HTML files  

---

## Technology Stack Summary

| Component | Technology | Version |
|-----------|-----------|---------|
| **Backend Framework** | Node.js + Express.js | v18+ / ^4.18.2 |
| **Database** | PostgreSQL | (Cloud - PlanetScale) |
| **Frontend** | HTML5 + CSS3 + Vanilla JS | ES6+ |
| **Password Hashing** | bcryptjs | ^2.4.3 |
| **HTTP Client** | axios | ^1.6.2 |
| **CORS** | cors middleware | ^2.8.5 |
| **Environment** | dotenv | ^16.3.1 |
| **Email Service** | Mandrill API | (External) |
| **Payment Gateway** | PayFast | (External) |
| **Hosting** | Any Node.js capable server | - |

---

## Environment Variables Reference

```
# Database Configuration
DB_HOST=us-east-3.pg.psdb.cloud        # PlanetScale host
DB_PORT=6432                            # PlanetScale port
DB_DATABASE=postgres                    # Database name
DB_USERNAME=postgres.xhjhjl0nh1cp       # DB user
DB_PASSWORD=pscale_pw_[...]             # DB password

# Server Configuration
PORT=3000                               # Server port
NODE_ENV=production                     # Environment (production/development)

# Optional Email/Payment (if needed in .env)
MANDRILL_API_KEY=[api-key]             # Mandrill email service
PAYFAST_MERCHANT_ID=[merchant-id]      # PayFast payment gateway
PAYFAST_MERCHANT_KEY=[merchant-key]
```

---

## Admin Access

**Admin Portal URL:** `https://www.rokthenats.co.za/admin.html`  
**Admin Password:** `natsadmin2026` (configured in code - can be changed in backend)

---

## Support & Maintenance

- **Database:** Monitor PostgreSQL connection and storage usage
- **Logs:** Check `server_log.txt` for errors
- **Backups:** Regular database backups recommended
- **SSL Certificate:** Ensure HTTPS is configured and valid
- **Node.js:** Keep Node.js updated to latest LTS version

---

**Last Updated:** January 2026  
**Project Version:** 1.0.0  
**Domain:** www.rokthenats.co.za
